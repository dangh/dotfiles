# vim:fileencoding=utf-8:foldmethod=marker

#: Config {{{

set-option -g   default-shell /opt/local/bin/fish

set-option -g   base-index 1
set-option -g   pane-base-index 1
set-option -g   renumber-windows on

# Faster command sequence
set-option -s   escape-time 0

# Have a very large history
set-option -g   history-limit 1000000

# Mouse support
set-option -ga  terminal-overrides "xterm*:smcup@:rmcup@"
set-option -g   mouse on

# Truecolor for Vim
set-option -g   default-terminal "xterm-256color"
set-option -ga  terminal-overrides ",xterm*:Tc"

#: }}}

#: Status line {{{
#: Varibles {{{
set-option -g   @symbol_left_fallback      ""
set-option -g   @symbol_left_alt_fallback  ""
set-option -g   @symbol_right_fallback     ""
set-option -g   @symbol_right_alt_fallback ""
set-option -g   @fg_fallback               "#859289"
set-option -g   @bg_fallback               "#323c41"
set-option -g   @fg_a_fallback             "#2b3339"
set-option -g   @bg_a_fallback             "#83c092"
set-option -g   @fg_A_fallback             "#2b3339"
set-option -g   @bg_A_fallback             "#e67e80"
set-option -g   @fg_b_fallback             "#9aa79d"
set-option -g   @bg_b_fallback             "#445055"
set-option -g   @fg_c_fallback             "#859289"
set-option -g   @bg_c_fallback             "#323c41"
set-option -g   @fg_x_fallback             "#859289"
set-option -g   @bg_x_fallback             "#323c41"
set-option -g   @fg_y_fallback             "#9aa79d"
set-option -g   @bg_y_fallback             "#445055"
set-option -g   @fg_z_fallback             "#2b3339"
set-option -g   @bg_z_fallback             "#83c092"
set-option -g   @fg_Z_fallback             "#2b3339"
set-option -g   @bg_Z_fallback             "#e67e80"
set-option -g   @fg_win_fallback           "#859289"
set-option -g   @bg_win_fallback           "#323c41"
set-option -g   @fg_cwin_fallback          "#83c092"
set-option -g   @bg_cwin_fallback          "#445055"
set-option -g   @symbol_left_computed      "#{?@symbol_left,#{E:@symbol_left},#{E:@symbol_left_fallback}}"
set-option -g   @symbol_left_alt_computed  "#{?@symbol_left_alt,#{E:@symbol_left_alt},#{E:@symbol_left_alt_fallback}}"
set-option -g   @symbol_right_computed     "#{?@symbol_right,#{E:@symbol_right},#{E:@symbol_right_fallback}}"
set-option -g   @symbol_right_alt_computed "#{?@symbol_right_alt,#{E:@symbol_right_alt},#{E:@symbol_right_alt_fallback}}"
set-option -g   @fg_computed               "#{?@fg,#{E:@fg},#{E:@fg_fallback}}"
set-option -g   @bg_computed               "#{?@bg,#{E:@bg},#{E:@bg_fallback}}"
set-option -g   @fg_a_computed             "#{?@fg_a,#{E:@fg_a},#{E:@fg_a_fallback}}"
set-option -g   @bg_a_computed             "#{?@bg_a,#{E:@bg_a},#{E:@bg_a_fallback}}"
set-option -g   @fg_A_computed             "#{?@fg_A,#{E:@fg_A},#{E:@fg_A_fallback}}"
set-option -g   @bg_A_computed             "#{?@bg_A,#{E:@bg_A},#{E:@bg_A_fallback}}"
set-option -g   @fg_b_computed             "#{?@fg_b,#{E:@fg_b},#{E:@fg_b_fallback}}"
set-option -g   @bg_b_computed             "#{?@bg_b,#{E:@bg_b},#{E:@bg_b_fallback}}"
set-option -g   @fg_c_computed             "#{?@fg_c,#{E:@fg_c},#{E:@fg_c_fallback}}"
set-option -g   @bg_c_computed             "#{?@bg_c,#{E:@bg_c},#{E:@bg_c_fallback}}"
set-option -g   @fg_x_computed             "#{?@fg_x,#{E:@fg_x},#{E:@fg_x_fallback}}"
set-option -g   @bg_x_computed             "#{?@bg_x,#{E:@bg_x},#{E:@bg_x_fallback}}"
set-option -g   @fg_y_computed             "#{?@fg_y,#{E:@fg_y},#{E:@fg_y_fallback}}"
set-option -g   @bg_y_computed             "#{?@bg_y,#{E:@bg_y},#{E:@bg_y_fallback}}"
set-option -g   @fg_z_computed             "#{?@fg_z,#{E:@fg_z},#{E:@fg_z_fallback}}"
set-option -g   @bg_z_computed             "#{?@bg_z,#{E:@bg_z},#{E:@bg_z_fallback}}"
set-option -g   @fg_Z_computed             "#{?@fg_Z,#{E:@fg_Z},#{E:@fg_Z_fallback}}"
set-option -g   @bg_Z_computed             "#{?@bg_Z,#{E:@bg_Z},#{E:@bg_Z_fallback}}"
set-option -g   @fg_win_computed           "#{?@fg_win,#{E:@fg_win},#{E:@fg_win_fallback}}"
set-option -g   @bg_win_computed           "#{?@bg_win,#{E:@bg_win},#{E:@bg_win_fallback}}"
set-option -g   @fg_cwin_computed          "#{?@fg_cwin,#{E:@fg_cwin},#{E:@fg_cwin_fallback}}"
set-option -g   @bg_cwin_computed          "#{?@bg_cwin,#{E:@bg_cwin},#{E:@bg_cwin_fallback}}"
#: }}}
#: Contents {{{
set-option -g   @content_a_fallback "#{session_name}"
set-option -g   @content_b_fallback ""
set-option -g   @content_c_fallback ""
set-option -g   @content_x_fallback "%a, %b %d"
set-option -g   @content_y_fallback ""
set-option -g   @content_z_fallback "%-l:%M"
set-option -g   @content_a_computed "#{s|^.+$| \\0 |:#{?@content_a,#{E:@content_a},#{E:@content_a_fallback}}}"
set-option -g   @content_b_computed "#{s|^.+$| \\0 |:#{?@content_b,#{E:@content_b},#{E:@content_b_fallback}}}"
set-option -g   @content_c_computed "#{s|^.+$| \\0 |:#{?@content_c,#{E:@content_c},#{E:@content_c_fallback}}}"
set-option -g   @content_x_computed "#{s|^.+$| \\0 |:#{?@content_x,#{E:@content_x},#{E:@content_x_fallback}}}"
set-option -g   @content_y_computed "#{s|^.+$| \\0 |:#{?@content_y,#{E:@content_y},#{E:@content_y_fallback}}}"
set-option -g   @content_z_computed "#{s|^.+$| \\0 |:#{?@content_z,#{E:@content_z},#{E:@content_z_fallback}}}"
#: }}}
#: Formats {{{
set-option -gF  @format_ab                    "#[fg=#{@bg_a_computed},bg=#{@bg_b_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_Ab                    "#[fg=#{@bg_A_computed},bg=#{@bg_b_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_bc                    "#[fg=#{@bg_b_computed},bg=#{@bg_c_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_ac                    "#[fg=#{@bg_a_computed},bg=#{@bg_c_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_Ac                    "#[fg=#{@bg_A_computed},bg=#{@bg_c_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_aa                    "#[fg=#{@fg_a_computed},bg=#{@bg_a_computed},bold]"
set-option -gF  @format_bb                    "#[fg=#{@fg_b_computed},bg=#{@bg_b_computed}]"
set-option -gF  @format_cc                    "#[fg=#{@fg_c_computed},bg=#{@bg_c_computed}]"
set-option -gF  @format_AA                    "#[fg=#{@fg_A_computed},bg=#{@bg_A_computed},bold]"
set-option -gF  @format_xy                    "#[fg=#{@bg_y_computed},bg=#{@bg_x_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_yz                    "#[fg=#{@bg_z_computed},bg=#{@bg_y_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_yZ                    "#[fg=#{@bg_Z_computed},bg=#{@bg_y_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_xz                    "#[fg=#{@bg_z_computed},bg=#{@bg_x_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_xZ                    "#[fg=#{@bg_Z_computed},bg=#{@bg_x_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_xx                    "#[fg=#{@fg_x_computed},bg=#{@bg_x_computed}]"
set-option -gF  @format_yy                    "#[fg=#{@fg_y_computed},bg=#{@bg_y_computed}]"
set-option -gF  @format_zz                    "#[fg=#{@fg_z_computed},bg=#{@bg_z_computed},bold]"
set-option -gF  @format_ZZ                    "#[fg=#{@fg_Z_computed},bg=#{@bg_Z_computed},bold]"
set-option -gF  @format_prev_window_left      "#[fg=#{@bg_computed},bg=#{@bg_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_prev_window_right     "#[fg=#{@bg_win_computed},bg=#{@bg_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_next_window_left      "#[fg=#{@bg_win_computed},bg=#{@bg_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_next_window_right     "#[fg=#{@bg_computed},bg=#{@bg_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_window_center         "#[fg=#{@fg_win_computed},bg=#{@bg_win_computed}]"
set-option -gF  @format_current_window_left   "#[fg=#{@bg_cwin_computed},bg=#{@bg_computed},nobold,nounderscore,noitalics]"
set-option -gF  @format_current_window_center "#[fg=#{@fg_cwin_computed},bg=#{@bg_cwin_computed}]"
set-option -gF  @format_current_window_right  "#[fg=#{@bg_cwin_computed},bg=#{@bg_computed},nobold,nounderscore,noitalics]"
#: }}}
#: Helpers {{{
set-option -wg  @before_active_window         "#{>:0,#{e|-|:#{window_index},#{active_window_index}}}"
set-option -wg  @after_active_window          "#{<:0,#{e|-|:#{window_index},#{active_window_index}}}"
#: }}}
#: Styled pane current path {{{
set-option -wg  @pane_current_path ""
set-option -wga @pane_current_path "#{?"
set-option -wga @pane_current_path   "#{m|r:^@vim@,#{pane_title}},"
set-option -wga @pane_current_path   "#{s|^@vim@||:#{pane_title}},"
set-option -wga @pane_current_path   "#{pane_current_path}"
set-option -wga @pane_current_path "}"
set-option -wg  @pane_current_path_styled ""
set-option -wga @pane_current_path_styled "#{s|^$HOME|～|;"
set-option -wga @pane_current_path_styled   "s|^~|～|;"
set-option -wga @pane_current_path_styled   "s|^.*/\\.ws/([^/]+)|\\1|;"
set-option -wga @pane_current_path_styled   "s|/|//|;"
set-option -wga @pane_current_path_styled   "s|/([^A-Za-z0-9/]*[A-Za-z0-9])[^/]*/|\\1/|;"
set-option -wga @pane_current_path_styled   "s|//|/|;"
set-option -wga @pane_current_path_styled   "s|[^/]+$|#[bold]\\0#[nobold]|:"
set-option -wga @pane_current_path_styled     "#{E:@pane_current_path}"
set-option -wga @pane_current_path_styled "}"
#: }}}
#: Styled window index {{{
set-option -wg  @window_index_styled ""
set-option -wga @window_index_styled "#{"
set-option -wga @window_index_styled   "s|0|０|;"
set-option -wga @window_index_styled   "s|1|１|;"
set-option -wga @window_index_styled   "s|2|２|;"
set-option -wga @window_index_styled   "s|3|３|;"
set-option -wga @window_index_styled   "s|4|４|;"
set-option -wga @window_index_styled   "s|5|５|;"
set-option -wga @window_index_styled   "s|6|６|;"
set-option -wga @window_index_styled   "s|7|７|;"
set-option -wga @window_index_styled   "s|8|８|;"
set-option -wga @window_index_styled   "s|9|９|:"
set-option -wga @window_index_styled   "#{window_index}"
set-option -wga @window_index_styled "}"
#: }}}
#: Styled window flags {{{
set-option -g   @window_flags ""
set-option -ga  @window_flags "#{"
set-option -ga  @window_flags   "s|~|～|;"
set-option -ga  @window_flags   "s|#|＃|;"
set-option -ga  @window_flags   "s|Z|Ｚ|;"
set-option -ga  @window_flags   "s|-|－|;"
set-option -ga  @window_flags   "s|*|＊|:"
set-option -ga  @window_flags   "#{window_flags}"
set-option -ga  @window_flags "}"
set-option -g   @window_zoomed ""
set-option -ga  @window_zoomed "#{?"
set-option -ga  @window_zoomed   "#{m|r:Z,#{window_flags}},"
set-option -ga  @window_zoomed   "  ,"
set-option -ga  @window_zoomed "}"
#: }}}
#: Format status line {{{
set-option -g   message-style "fg=#83c092,bg=#445055"
set-option -g   message-command-style "fg=#83c092,bg=#445055"
set-option -g   pane-border-style "fg=#445055"
set-option -g   pane-active-border-style "fg=#83c092"
set-option -g   status "on"
set-option -g   status-justify "centre"
set-option -gF  status-style "none,bg=#{@bg_computed}"
set-option -g   status-left-length "100"
set-option -g   status-left-style "none"
set-option -g   status-left ""
set-option -ga  status-left "#{?client_prefix,"
set-option -ga  status-left   "#{E:@format_AA}#{E:@content_a_computed}"
set-option -ga  status-left   "#{E:@format_Ab}#{E:@symbol_left_computed}"
set-option -ga  status-left   ","
set-option -ga  status-left   "#{E:@format_aa}#{E:@content_a_computed}"
set-option -ga  status-left   "#{E:@format_ab}#{E:@symbol_left_computed}"
set-option -ga  status-left "}"
set-option -ga  status-left "#{E:@format_bb}#{E:@content_b_computed}"
set-option -ga  status-left "#{E:@format_bc}#{E:@symbol_left_computed}"
set-option -ga  status-left "#{E:@format_cc}#{E:@content_c_computed}"
set-option -g   status-right-length "100"
set-option -g   status-right-style "none"
set-option -g   status-right ""
set-option -ga  status-right "#{E:@format_xx}#{E:@content_x_computed}"
set-option -ga  status-right "#{E:@format_xy}#{E:@symbol_right_computed}"
set-option -ga  status-right "#{E:@format_yy}#{E:@content_y_computed}"
set-option -ga  status-right "#{E:@format_yz}#{E:@symbol_right_computed}"
set-option -ga  status-right "#{E:@format_zz}#{E:@content_z_computed}"
set-option -wg  window-status-activity-style "none"
set-option -wgF window-status-style "none,fg=#{@fg_computed},bg=#{@bg_computed}"
set-option -wg  window-status-separator ""
set-option -wg  window-status-format ""
set-option -wga window-status-format "#{?#{E:@before_active_window},"
set-option -wga window-status-format   "#{E:@format_prev_window_left}#{E:@symbol_right_alt_computed},"
set-option -wga window-status-format "}"
set-option -wga window-status-format "#{?#{E:@after_active_window},"
set-option -wga window-status-format   "#{E:@format_next_window_left}#{E:@symbol_right_alt_computed},"
set-option -wga window-status-format "}"
set-option -wga window-status-format "#{E:@format_window_center} #{E:@window_index_styled}. #{E:@pane_current_path_styled}#{E:@window_zoomed} "
set-option -wga window-status-format "#{?#{E:@before_active_window},"
set-option -wga window-status-format   "#{E:@format_prev_window_right}#{E:@symbol_left_alt_computed},"
set-option -wga window-status-format "}"
set-option -wga window-status-format "#{?#{E:@after_active_window},"
set-option -wga window-status-format   "#{E:@format_next_window_right}#{E:@symbol_left_alt_computed},"
set-option -wga window-status-format "}"
set-option -wg  window-status-current-format ""
set-option -wga window-status-current-format "#{E:@format_current_window_left}#{E:@symbol_right_computed}"
set-option -wga window-status-current-format "#{E:@format_current_window_center} #{E:@window_index_styled}. #{E:@pane_current_path_styled}#{E:@window_zoomed} "
set-option -wga window-status-current-format "#{E:@format_current_window_right}#{E:@symbol_left_computed}"
#: }}}
#: }}}

#: Title for Alacritty {{{
set-option -g   @title_string ""
set-option -ga  @title_string "#{s|^$HOME|~|:"
set-option -ga  @title_string   "#{E:@pane_current_path}"
set-option -ga  @title_string "}"
set-option -g   set-titles on
set-option -g   set-titles-string "#{E:@title_string}"
#: }}}

#: Key bindings {{{

# Disable confirm before killing
bind-key x kill-pane

# Reload config
unbind-key r
bind-key r source-file ~/.tmux.conf \; display "Config reloaded!"

# Create new pane/window at currrent directory
bind-key '"' split-window -c "#{pane_current_path}"
bind-key % split-window -h -c "#{pane_current_path}"
bind-key c new-window -c "#{pane_current_path}"
# Better shortcuts
bind-key -n C-_ split-window -c "#{pane_current_path}"
bind-key -n C-\\ split-window -h -c "#{pane_current_path}"
bind-key -n C-t new-window -c "#{pane_current_path}"

# Pane navigation
bind-key -n C-k select-pane -U
bind-key -n C-j select-pane -D
bind-key -n C-h select-pane -L
bind-key -n C-l select-pane -R

#: }}}
